{% extends 'base.html' %} {% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='booking.css') }}" />
{% endblock %} {% block content %}
<img src="../static/assets/images/PARVAH (6).png" class="bg-left" alt="Background Left" />
<img src="../static/assets/images/PARVAH (5).png" class="bg-right" alt="Background Right" />

<div style="padding: 50px"></div>

<div class="booking-container">
  <div class="logo-container">
    <img src="../static/assets/images/Parvaah-logo.png" alt="Parvaah Logo" />
  </div>
  <h1>Book a Service</h1>

  <!-- Booking Form -->
  <form action="{{ url_for('booking') }}" method="POST">
    <!-- Type Dropdown -->
    <label for="type">Type of Service</label>
    <select id="type" name="type" onchange="updateServices()">
      <option value="">Select Type</option>
      <option value="homecare">Home Care</option>
      <option value="medicalcare">Medical Care</option>
    </select>

    <!-- Service Dropdown -->
    <label for="service">Service</label>
    <select id="service" name="service">
      <option value="">Select Service</option>
    </select>

    <!-- Start Date & Time -->
    <label for="start-date">Start Date</label>
    <input type="date" id="start-date" name="start_date" required />

    <label for="start-time">Start Time</label>
    <input type="time" id="start-time" name="start_time" required />

    <!-- End Date & Time -->
    <label for="end-date">End Date</label>
    <input type="date" id="end-date" name="end_date" required />

    <label for="end-time">End Time</label>
    <input type="time" id="end-time" name="end_time" required />

    <!-- Fare Display -->
    <div class="fare-display" id="fare-display">
      Estimated Fare: â‚¹<span id="fare">0</span>
    </div>

    <!-- Buttons -->
    <div class="button-container">
      <button type="button" class="cancel-btn" onclick="cancelBooking()">
        Cancel
      </button>
      <button type="button" class="book-btn" onclick="calculateFare()">
        Estimate
      </button>
      <button type="submit" class="book-btn">Book Service</button>
    </div>
  </form>
</div>

<script>
  document.addEventListener( "DOMContentLoaded", ( event ) => {
    const urlParams = new URLSearchParams( window.location.search );
    const type = urlParams.get( "type" );
    const service = urlParams.get( "service" );

    if ( type ) {
      document.getElementById( "type" ).value = type;
      updateServices( service ); // Pass the service to pre-select it
    }
  } );

  const services = {
    homecare: [ "Housekeeping", "Cooking", "Laundary" ],
    medicalcare: [ "Blood Test", "Bathing/Dressing", "Nursing", "Physiotherapy" ],
  };

  function updateServices ( selectedService = "" ) {
    const type = document.getElementById( "type" ).value;
    const serviceDropdown = document.getElementById( "service" );
    serviceDropdown.innerHTML = '<option value="">Select Service</option>';

    if ( type && services[ type ] ) {
      services[ type ].forEach( ( service ) => {
        const option = document.createElement( "option" );
        option.value = service;
        option.textContent = service;
        serviceDropdown.appendChild( option );
      } );

      // Select the service if passed
      if ( selectedService ) {
        serviceDropdown.value = selectedService;
      }
    }
  }

  function calculateFare () {
    const startDate = document.getElementById( "start-date" ).value;
    const startTime = document.getElementById( "start-time" ).value;
    const endDate = document.getElementById( "end-date" ).value;
    const endTime = document.getElementById( "end-time" ).value;

    if ( startDate && startTime && endDate && endTime ) {
      const start = new Date( startDate + "T" + startTime + "Z" );
      const end = new Date( endDate + "T" + endTime + "Z" );
      const diff = ( end - start ) / ( 1000 * 60 * 60 );
      console.log( "Start date n time:", start, "End date n time", end, "Diff", diff );
      if ( diff > 0 ) {
        const fare = diff * 200;
        document.getElementById( "fare" ).textContent = fare.toFixed( 2 );
        document.getElementById( "fare-display" ).style.display = "block";
      } else {
        alert( "End date and time must be later than start date and time." );
      }
    } else {
      alert( "Please select both start and end dates and times." );
    }
  }

  function cancelBooking () {
    window.history.back();
  }
</script>

{% endblock content %}
